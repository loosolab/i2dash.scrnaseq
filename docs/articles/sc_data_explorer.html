<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use-case 2: Single-cell data explorer • i2dash.scrnaseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use-case 2: Single-cell data explorer">
<meta property="og:description" content="i2dash.scrnaseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">i2dash.scrnaseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Get started</li>
    <li>
      <a href="../articles/Quality_metrics.html">Use-case 1: Quality metrics</a>
    </li>
    <li>
      <a href="../articles/sc_data_explorer.html">Use-case 2: Single-cell Data explorer</a>
    </li>
    <li>
      <a href="../articles/vis_parameterselection.html">Use-case 3: Visualized parameter selection</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Further reading</li>
    <li>
      <a href="../articles/Documentation.html">Documentation</a>
    </li>
    <li>
      <a href="../articles/Developer_guide.html">Developer guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sc_data_explorer_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="sc_data_explorer_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="sc_data_explorer_files/anchor-sections-1.0/anchor-sections.js"></script><link href="sc_data_explorer_files/font-awesome-5.1.0/css/all.css" rel="stylesheet">
<link href="sc_data_explorer_files/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use-case 2: Single-cell data explorer</h1>
                        <h4 class="author">Arsenij Ustjanzew</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:arsenij.ustjanzew@mpi-bn.mpg.de" class="email">arsenij.ustjanzew@mpi-bn.mpg.de</a>
      
                              <h4 class="author">Jens Preussner</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:jens.preussner@mpi-bn.mpg.de" class="email">jens.preussner@mpi-bn.mpg.de</a>
      
                  
            <h4 class="date">5 November 2020</h4>
      
      
      <div class="hidden name"><code>sc_data_explorer.Rmd</code></div>

    </div>

    
    
<p>Vignette last complied on 2020-11-05. i2dash is licenced under MIT + file LICENSE.</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In the following example we build a dashboard, which enables the exploration of gene expression values and metadata coupled with low dimensional embedding. Instead of creating local objects and load these in the components, like we did in the <a href="Quality_metrics.html">previous use case</a>, we use mainly native tools and pre-defined pages from the <code>i2dash.scrnaseq</code> package. You can inspect the demo of the resulting dashboard <a href="https://mpibn.paper.ingress.rancher.computational.bio/use-case-2/i2dash/">here</a>.</p>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>At first, load the SingleCellExperiment object of the data we used in the first use-case (see <a href="https://loosolab.github.io/i2dash.scrnaseq/articles/Quality_metrics.html">here</a>). We subset the sce object according to the identified outliers, perform a log-transformed normalization on the count-matrix and identify the highly variable genes. For these steps, the packages <a href="https://bioconductor.org/packages/3.10/bioc/html/scater.html">scater</a> and <a href="http://bioconductor.org/packages/release/bioc/html/scran.html">scran</a> are used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>

<span class="co"># Read the SingleCellExperiment</span>
<span class="va">sce_full</span> <span class="op">&lt;-</span> <span class="fu">scRNAseq</span><span class="fu">::</span><span class="fu">ZilionisLungData</span><span class="op">(</span><span class="st">"mouse"</span><span class="op">)</span>
<span class="va">sce_full</span> <span class="op">&lt;-</span> <span class="va">sce_full</span><span class="op">[</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">$</span><span class="va">Used</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span>,<span class="st">"_"</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">$</span><span class="va">Library</span><span class="op">)</span>
<span class="va">as_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Library"</span>, <span class="st">"Animal"</span>, <span class="st">"Run"</span>, <span class="st">"Tissue"</span>, <span class="st">"Library prep batch"</span>, <span class="st">"Most likely Immgen cell type"</span>, <span class="st">"Major cell type"</span>, <span class="st">"Minor subset"</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">[</span><span class="va">as_factor</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">[</span><span class="va">as_factor</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span><span class="op">)</span>

<span class="co"># optional downsampling for better performance</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce_full</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span>, <span class="fl">6000</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Cell-level QC</span>
<span class="va">per.cell</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span>, subsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Mito <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"mt-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">per.cell</span><span class="op">)</span>

<span class="co"># Detect outliers</span>
<span class="va">qc.stats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/quickPerCellQC.html">quickPerCellQC</a></span><span class="op">(</span><span class="va">sce</span>, percent_subsets<span class="op">=</span><span class="st">"subsets_Mito_percent"</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">qc.stats</span><span class="op">)</span>

<span class="co"># Filtering</span>
<span class="va">sce2</span>         <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="op">!</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">discard</span><span class="op">]</span>
<span class="va">keep_feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/nexprs.html">nexprs</a></span><span class="op">(</span><span class="va">sce</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>
<span class="va">sce2</span>         <span class="op">&lt;-</span> <span class="va">sce2</span><span class="op">[</span><span class="va">keep_feature</span>,<span class="op">]</span>

<span class="co"># Normalization</span>
<span class="va">sce2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/logNormCounts.html">logNormCounts</a></span><span class="op">(</span><span class="va">sce2</span><span class="op">)</span>

<span class="co"># Get highly variable genes</span>
<span class="va">gene.var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html">modelGeneVar</a></span><span class="op">(</span><span class="va">sce2</span><span class="op">)</span> <span class="co"># the warning message can be ignored</span>
<span class="va">hvg</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html">getTopHVGs</a></span><span class="op">(</span><span class="va">gene.var</span>, prop<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></pre></div>
</div>
<div id="creating-an-i2dashboard-object" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-an-i2dashboard-object" class="anchor"></a>Creating an i2dashboard object</h1>
<p>Simmilar to the first use-case, we create the <code>i2dashboard</code> object. In contrast, the mode of this dashboard is “interactive” (<code>interactive = TRUE</code>), which means that the interactivity is increased through Shiny input options.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://loosolab.github.io/i2dash/">i2dash</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gitlab.gwdg.de/loosolab/software/i2dash.scrnaseq">i2dash.scrnaseq</a></span><span class="op">)</span>

<span class="co"># Creating a new i2dashboard class object</span>
<span class="va">dashboard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-class.html">i2dashboard</a></span><span class="op">(</span>
  title       <span class="op">=</span> <span class="st">"Single-Cell Data Explorer"</span>,
  author      <span class="op">=</span> <span class="st">"i2dash Team"</span>,
  interactive <span class="op">=</span> <span class="cn">TRUE</span>,
  theme       <span class="op">=</span> <span class="st">"yeti"</span>,
  datadir     <span class="op">=</span> <span class="st">"datadir_use_case2"</span>
<span class="op">)</span></pre></div>
</div>
<div id="explorer-for-cell-metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#explorer-for-cell-metadata" class="anchor"></a>Explorer for cell metadata</h1>
<p>The following page for cell metadata analysis is one of the pre-defined pages in the <code>i2dash.scrnaseq</code> package. We add and define this page with the function <code><a href="../reference/add_dimred_sample_page.html">add_dimred_sample_page()</a></code>.</p>
<p>This page provides the possibility to inspect the dimension reduction and distribution of cell metadata (e.g. cluster, timepoint, number of genes, etc). The page is build up on the 2x2 grid layout, which means that it may conatain a maximum of four components. The first component is obligatory a dimension reduction plot and the three other component slots are occupied by either box-, bar- or silhouette plots.</p>
<ul>
<li><p><strong>Reduced dimension plot:</strong> The data to use for the reduced dimension plot is defined by the parameter <code>use_dimred</code>. The plot is coloured by factorial metadata. With the parameter <code>sample_metadata</code> we provide a character vector containing the column names of sample metadata stored in the SingleCellExperiment or Seurat object. The parameter <code>group_by</code> should be one of the column names from <code>sample_metadata</code> and defines the colouring of the scatterplot. In the interactive mode of the dashboard, we can choose from columns of factorial data and colour the scatter plot by this factors. E.g. this is useful when we have processed a clustering on the dimension reduction and provide the name of the metadata column containing the clustering result with <code>sample_metadata</code>.</p></li>
<li><p><strong>Bar- / box plots:</strong> As was said, the remaining component slots are occupied by box- or bar plots. The data for these plots is also defined in <code>sample_metadata</code>. The data type of the metadata determines whether the component is a bar- or a boxplot. Factorial data results in a barplot: The bars are the levels and the height of the bars represents the number of observation of the level. Numeric data produces a boxplot, which is grouped along the x-axis by the factorial metadata defined with <code>group_by</code>. In the interactive mode, the box plot is grouped by the selected data in the dropdown menu. Note, that the colors used for the box plot groups correspond to the colors used in the scatterplot.</p></li>
<li><p><strong>Silhouette plot:</strong> Optionally we can define that one of the tree slots is occupied by a silhouette plot. This is done by setting the parameter <code>show_silhouette</code> to <code>TRUE</code>. The grouping of the silhouette plot is also defined by <code>group_by</code> parameter and can be changed in the interactive mode.</p></li>
<li><p><strong>Additional barplot:</strong> Per default, one of the three slots is occupied by a bar plot that shows the number of observations of data defined by <code>group_by</code> or the selection of the dropdown menu in the interactive mode. It is possible to prevent this behaviour by setting the parameter <code>show_group_sizes</code> to <code>FALSE</code>.</p></li>
</ul>
<p>A special feature of this page is, that the plots are linked together. This means that it is possible to select several points in the scatterplot of the dimension reduction or bars in the bar-/ silhouette plots with <code>plotly</code>’s selection tool. According to the selection the other plots are recalculated. This functionality works also in the static mode of the dashboard.</p>
<p>In this example we create two of these pages. Both pages are grouped under the button “Cell metadata” in the navigation bar. The first page contains a dimension reduction, a bar plot of the groups shown in the dimension reduction, a silhouette plot and a box plot of the <code>subsets_Mito_percent</code> column. Therefore, we provide only two metadata columns in <code>sample_metadata</code>. The second page does not contain the silhouette plot or the bar plot of <code>group_by</code>, instead we provide three more metadata column names, which will be used in the three free component slots.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># Page for metadata exploration with show_group_sizes = TRUE and show_silhouette = TRUE (see left image below) </span>
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="fu"><a href="../reference/add_dimred_sample_page.html">add_dimred_sample_page</a></span><span class="op">(</span>
  object           <span class="op">=</span> <span class="va">sce2</span>,
  use_dimred       <span class="op">=</span> <span class="st">"SPRING"</span>,
  sample_metadata  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span>, <span class="st">"subsets_Mito_percent"</span>, <span class="st">"Library"</span>, <span class="st">"Tissue"</span><span class="op">)</span>,
  group_by         <span class="op">=</span> <span class="st">"Major.cell.type"</span>,
  show_group_sizes <span class="op">=</span> <span class="cn">TRUE</span>,
  show_silhouette  <span class="op">=</span> <span class="cn">TRUE</span>,
  page             <span class="op">=</span> <span class="st">"dimred_sample_page1"</span>,
  title            <span class="op">=</span> <span class="st">"Cell metadata 1"</span>,
  menu             <span class="op">=</span> <span class="st">"Cell metadata"</span>
<span class="op">)</span>

<span class="co"># Page for metadata exploration with show_group_sizes = FALSE and show_silhouette = FALSE (see right image below) </span>
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="fu"><a href="../reference/add_dimred_sample_page.html">add_dimred_sample_page</a></span><span class="op">(</span>
  object           <span class="op">=</span> <span class="va">sce2</span>,
  use_dimred       <span class="op">=</span> <span class="st">"SPRING"</span>,
  sample_metadata  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span>, <span class="st">"Tissue"</span>, <span class="st">"sum"</span>, <span class="st">"detected"</span><span class="op">)</span>,
  group_by         <span class="op">=</span> <span class="st">"Major.cell.type"</span>,
  show_group_sizes <span class="op">=</span> <span class="cn">FALSE</span>,
  show_silhouette  <span class="op">=</span> <span class="cn">FALSE</span>,
  page             <span class="op">=</span> <span class="st">"dimred_sample_page2"</span>,
  title            <span class="op">=</span> <span class="st">"Cell metadata 2"</span>,
  menu             <span class="op">=</span> <span class="st">"Cell metadata"</span>
<span class="op">)</span></pre></div>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="center">Metadata exploration with <code>show_group_sizes = TRUE</code> and <code>show_silhouette = TRUE</code>
</th>
<th align="center">Metadata exploration with <code>show_group_sizes = FALSE</code> and <code>show_silhouette = FALSE</code>
</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="images/use_case_2/cell_metadata1.PNG"></td>
<td align="center"><img src="images/use_case_2/cell_metadata2.PNG"></td>
</tr></tbody>
</table>
</div>
<div id="explorer-for-gene-expression" class="section level1">
<h1 class="hasAnchor">
<a href="#explorer-for-gene-expression" class="anchor"></a>Explorer for gene expression</h1>
<p>The next page enables the exploration of gene expression values along the dimension reduction and clustering. This can be very useful e.g. for marker genes to compare their expression with the clustering. We add and define this page with the <code><a href="../reference/add_feature_expression_page.html">add_feature_expression_page()</a></code> method.</p>
<p>The page is build up on the 2x2 grid layout: + <strong>Table of genes:</strong> The top left component is a table representing the statistic of the number of cells per grouping factor. Each row corresponds to a gene. We define the genes in the table with the parameter <code>subset_row</code>. In our example the first hundred highly variable genes are used. We provide several grouping factors with the parameter <code>group_by</code>. The grouping factor can be interactively selected.</p>
<ul>
<li><p><strong>Violin plot:</strong> The violin plot is located in the bottom left corner of the page and shows the expression values of the gene selected in the table. The plot is grouped by the selected grouping factor.</p></li>
<li><p><strong>Reduced dimension plots:</strong> On the right side of the page two scatterplots represent the dimension reduction (<code>use_dimred</code>). The upper one is coloured by expression values of the selected gene. The lower one is coloured by the selected grouping factor.</p></li>
</ul>
<p>The components are linked together, which means that it is possible to select a row in the table, which represents a gene and the upper scatterplot changes its colouring according to the expression values of the selected gene. The distributions in the violinplot are also recalculated. Further, it is possible to select several points in the scatterplot with <code>plotly</code>’s selection tool. According to the selection the violin plot reacts and is recalculated. This functionality works also in the static mode.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="fu"><a href="../reference/add_feature_expression_page.html">add_feature_expression_page</a></span><span class="op">(</span>
  object       <span class="op">=</span> <span class="va">sce2</span>,
  use_dimred   <span class="op">=</span> <span class="st">"SPRING"</span>,
  exprs_values <span class="op">=</span> <span class="st">"logcounts"</span>,
  group_by     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span>, <span class="st">"Tissue"</span>, <span class="st">"Library"</span><span class="op">)</span>,
  subset_row   <span class="op">=</span> <span class="va">hvg</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>,
  title        <span class="op">=</span> <span class="st">"Gene explorer"</span>
<span class="op">)</span>

<span class="co"># The warning message: "attributes are not identical across measure variables; they will be dropped" can be ignored.</span></pre></div>
<p><img src="images/use_case_2/feature_explorer.PNG"></p>
</div>
<div id="marker-gene-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#marker-gene-detection" class="anchor"></a>Marker gene detection</h1>
<p>The used data set already contains metadata of a clustering. On the previous page we have already used the metadata “Major.cell.type” to colour the clusters of the scatterplot. To interpret these clusters, we need to identify the genes that drive separation between clusters. “These marker genes allow us to assign biological meaning to each cluster based on their functional annotation. In the most obvious case, the marker genes for each cluster are a priori associated with particular cell types, allowing us to treat the clustering as a proxy for cell type identity.” <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>We use the <code><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers()</a></code> function from the <code>scran</code> package to get a DataFrame for each cluster containing the ranked genes based on the pairwise comparison of their differential gene expression between clusters. The <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> function subsets the first ten marker gene candidates for each cluster. Finally, we get a vector with these unique marker gene candidates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce2</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">sce2</span><span class="op">)</span><span class="op">$</span><span class="va">Major.cell.type</span><span class="op">)</span>
<span class="va">marker_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">markers</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>
<span class="va">marker_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">marker_list</span>, recursive <span class="op">=</span> <span class="cn">F</span>, use.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>The expression values grouped by the clusters can be nicely displayed as a heatmap. Therefore, we add an interactive heatmap to the next page of the dashboard. This component has the advantage of some interactive elements, e.g. the possibility to split or aggregate the heatmap according to a grouping or to cluster the rows and columns. The heatmap visualize each cell as column and the marker genes as rows. The color value corresponds to the expression value of the respective gene. We create the component with the <code><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-content.html">add_component()</a></code> function and provide the function <code><a href="../reference/heatmap.html">i2dash.scrnaseq::heatmap</a></code> as the <code>component</code> parameter. We define the <code>logcount</code> assay, which should be used for the expression values of the heatmap. With <code>subset_row</code> we subset the assay according to the marker candidates. Further, we provide the possibility to split or group the heatmap according to factorial metadata e.g. “Major.cell.type”. We define several metadata columns so that the user can select the grouping interactively.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-pages.html">add_page</a></span><span class="op">(</span>
  page   <span class="op">=</span> <span class="st">"marker"</span>,
  title  <span class="op">=</span> <span class="st">"Marker genes"</span>,
  layout <span class="op">=</span> <span class="st">"default"</span>
<span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  page         <span class="op">=</span> <span class="st">"marker"</span>,
  component    <span class="op">=</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="va"><a href="../reference/heatmap.html">heatmap</a></span>,
  object       <span class="op">=</span> <span class="va">sce2</span>,
  exprs_values <span class="op">=</span> <span class="st">"logcounts"</span>,
  subset_row   <span class="op">=</span> <span class="va">marker_names</span>,
  split_by     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span>, <span class="st">"Tissue"</span>, <span class="st">"Library"</span><span class="op">)</span>,
  aggregate_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Major.cell.type"</span>, <span class="st">"Tissue"</span>, <span class="st">"Library"</span><span class="op">)</span>,
  title        <span class="op">=</span> <span class="st">"Expression of marker genes"</span>
<span class="op">)</span></pre></div>
<p>Interactively, the end-user can select <code>Major.cell.type</code> in the “Split columns by” dropdown menu found in the plot settings (the red gear button) and set “Clustering” to <code>row</code>. This will produce the heatmap shown below. With this heatmap it is possible to visualize the extression values of the marker genes according to their cluster.</p>
<p><img src="images/use_case_2/heatmap.PNG"></p>
</div>
<div id="tools" class="section level1">
<h1 class="hasAnchor">
<a href="#tools" class="anchor"></a>Tools</h1>
<p>In the first use-case, we created objects and used them as input for the <code><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-content.html">add_component()</a></code> function. In this way, we visualized the metadata of the <code>SingleCellExperiment</code>. Now we want to use components of <code>i2dash.scrnaseq</code>, which allows us to provide an enhanced interactivity for the end-user. With the <code><a href="../reference/scatterplot.html">i2dash.scrnaseq::scatterplot</a></code> component we can easily define several columns of metadata plotted along the axis, so the user can interactively choose the data he is most interested in.</p>
<p>To create this scatterplot component, the function <code><a href="../reference/scatterplot.html">i2dash.scrnaseq::scatterplot</a></code> is used in the function call of <code><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-content.html">add_component()</a></code>. Then we need to provide further specific parameters required by <code><a href="../reference/scatterplot.html">i2dash.scrnaseq::scatterplot</a></code>. We provide the <code>sce</code> object, from which the required data will extracted. Further, we limit the columns the end-user can choose from by providing the parameters <code>x</code>, <code>y</code> and <code>colour_by</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-pages.html">add_page</a></span><span class="op">(</span>
  page   <span class="op">=</span> <span class="st">"tools_1"</span>,
  title  <span class="op">=</span> <span class="st">"Interactive scatter plot"</span>,
  layout <span class="op">=</span> <span class="st">"default"</span>,
  menu   <span class="op">=</span> <span class="st">"Tools"</span>
<span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://loosolab.github.io/i2dash/reference/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="va"><a href="../reference/scatterplot.html">scatterplot</a></span>,
  page      <span class="op">=</span> <span class="st">"tools_1"</span>,
  title     <span class="op">=</span> <span class="st">"scatter plot of metadata"</span>,
  object    <span class="op">=</span> <span class="va">sce2</span>,
  from      <span class="op">=</span> <span class="st">"colData"</span>,
  x         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="st">"detected"</span>, <span class="st">"subsets_Mito_percent"</span><span class="op">)</span>,
  y         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="st">"detected"</span>, <span class="st">"subsets_Mito_percent"</span><span class="op">)</span>,
  colour_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tissue"</span>, <span class="st">"Major.cell.type"</span>, <span class="st">"Library"</span>, <span class="st">"discard"</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p><img src="images/use_case_2/scatterplot.PNG"></p>
<p>Another pre-defined page, that is only used in the interactive mode, is the “Feature grid” page. It visualizes several feature expressions (obtained from <code>exprs_values</code>) along a dimension reduction in a grid layout. Interactively, the user can select the dimension reduction (defined by the parameter <code>use_dimred</code>), several features of interest (from <code>subset_row</code>) and the number of columns of the grid layout. If <code>subset_row</code> is not provided, all features of <code>exprs_values</code> are selectible on the page. After the user selceted the features, the image will be generated by clicking on the button “Generate plot”. This page enables the user to create and download high-quality figures with user-defined dimensions for presentations/ publications.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="fu"><a href="../reference/add_feature_grid_page.html">add_feature_grid_page</a></span><span class="op">(</span>
  object       <span class="op">=</span> <span class="va">sce2</span>,
  use_dimred   <span class="op">=</span> <span class="st">"SPRING"</span>,
  exprs_values <span class="op">=</span> <span class="st">"logcounts"</span>,
  subset_row   <span class="op">=</span> <span class="va">hvg</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>
<span class="op">)</span></pre></div>
<p><img src="images/use_case_2/feature_grid.PNG"></p>
</div>
<div id="assembling-the-dashboard" class="section level1">
<h1 class="hasAnchor">
<a href="#assembling-the-dashboard" class="anchor"></a>Assembling the dashboard</h1>
<p>The final step is the assembly of the dashboard. During this step an R markdown (Rmd) document is created. This Rmd file needs to be deployed to a Shiny Server. You can use the i2dash docker container available <a href="https://gitlab.gwdg.de/loosolab/container/i2dash.deployment">here</a> to create a local Shiny server. Alternatively, you can view the dashboard by clicking the “Run Document” button in RStudio IDE.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://loosolab.github.io/i2dash/reference/assemble.html">assemble</a></span><span class="op">(</span><span class="va">dashboard</span>, file <span class="op">=</span> <span class="st">"scDataExplorer.Rmd"</span>, exclude <span class="op">=</span> <span class="st">"default"</span><span class="op">)</span></pre></div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://osca.bioconductor.org/marker-detection.html">“Marker gene detection”</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Arsenij Ustjanzew, Jens Preussner, Mario Looso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
