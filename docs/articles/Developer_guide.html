<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A guide for developer • i2dash.scrnaseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A guide for developer">
<meta property="og:description" content="i2dash.scrnaseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">i2dash.scrnaseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Get started</li>
    <li>
      <a href="../articles/Quality_metrics.html">Use-case 1: Quality metrics</a>
    </li>
    <li>
      <a href="../articles/sc_data_explorer.html">Use-case 2: Single-cell Data explorer</a>
    </li>
    <li>
      <a href="../articles/vis_parameter_selection.html">Use-case 3: Visual parameter selection</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Further reading</li>
    <li>
      <a href="../articles/Documentation.html">Documentation</a>
    </li>
    <li>
      <a href="../articles/Developer_guide.html">Developer guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Developer_guide_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="Developer_guide_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Developer_guide_files/anchor-sections-1.0/anchor-sections.js"></script><link href="Developer_guide_files/font-awesome-5.1.0/css/all.css" rel="stylesheet">
<link href="Developer_guide_files/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A guide for developer</h1>
                        <h4 class="author">Arsenij Ustjanzew</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:arsenij.ustjanzew@gmail.com" class="email">arsenij.ustjanzew@gmail.com</a>
      
                              <h4 class="author">Jens Preussner</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:jens.preussner@mpi-bn.mpg.de" class="email">jens.preussner@mpi-bn.mpg.de</a>
      
                  
            <h4 class="date">6 November 2020</h4>
      
      
      <div class="hidden name"><code>Developer_guide.Rmd</code></div>

    </div>

    
    
<p><strong>Compiled date</strong>: 2020-11-06</p>
<p><strong>Last edited</strong>: 23.09.2019</p>
<p><strong>License</strong>:</p>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>It is possible to create new components that can be used as regular i2dash.scrnaseq functions and extend the capabilities of your i2dashboard. This tutorial shows how to create a new component and how to implement shiny input and output widgets to provide interactive elements for the user. Moreover, it is explained how to create a new customized page and link plotly based charts together and datatables of <em><a href="https://bioconductor.org/packages/3.11/DT">DT</a></em> with several plotly based charts.</p>
</div>
<div id="example-of-custom-components" class="section level1">
<h1 class="hasAnchor">
<a href="#example-of-custom-components" class="anchor"></a>Example of custom components</h1>
<p>This example demonstrates how to create a plotly based bubble chart as an i2dash component.</p>
<div id="r-function-for-the-plot-itself" class="section level2">
<h2 class="hasAnchor">
<a href="#r-function-for-the-plot-itself" class="anchor"></a>R function for the plot itself</h2>
<p>At first, we need to create a function with minimal plotly code for the bubbleplot. The <code>[...]</code> argument allow us to expand our possibilities to modify the plot. This code can be written in the file <code>R/visualization_functions.R</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">#' Render a bubbleplot with plotly.</span>
<span class="co">#'</span>
<span class="co">#' @param x Numeric observations mapped to the x-axis.</span>
<span class="co">#' @param y Numeric observations mapped to the y-axis.</span>
<span class="co">#' @param size Numeric values defining the size of the dots.</span>
<span class="co">#' @param x_title The title of the x-axis.</span>
<span class="co">#' @param y_title The title of the y-axis.</span>
<span class="co">#' @param ... these arguments are of either the form value or tag = value and should be valid for the 'plotly::plot_ly()' method.</span>
<span class="co">#'</span>
<span class="co">#' @return An object of class \code{plotly}.</span>
<span class="co">#' @export</span>
<span class="va">plotly_bubbleplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">size</span>, <span class="va">x_title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">y_title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, size <span class="op">=</span> <span class="va">size</span>, type <span class="op">=</span> <span class="st">'scatter'</span>, mode <span class="op">=</span> <span class="st">'markers'</span>, marker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> oparcity <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">x_title</span>, showgrid <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
                   yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">y_title</span>, showgrid <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="op">)</span>
<span class="op">}</span></pre></div>
</div>
<div id="r-function-for-custom-components" class="section level2">
<h2 class="hasAnchor">
<a href="#r-function-for-custom-components" class="anchor"></a>R function for custom components</h2>
<p>Now we create a new file <code>R/bubbleplot.R</code> and write the function that evaluates the input and saves it in an .Rds file for this component. The input for this function:</p>
<ul>
<li>
<strong>dashboard</strong>: the i2dashboard object to add the component.</li>
<li>
<strong>x</strong>, <strong>y</strong>, <strong>size</strong>, <strong>colour_by</strong>: to provide the interactivity these parameters accept data.frames. The columns are possible selection options in the shiny dropdown menues.</li>
<li>
<strong>labels</strong>: should be a character vector. This argument is optional and will be displayed by mouse hover.</li>
<li>
<strong>title</strong>, <strong>x_title</strong>, <strong>y_title</strong>: these parapeters are also optional and should be characters.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">bubbleplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dashboard</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">size</span>, <span class="va">colour_by</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">labels</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">x_title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">y_title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
 <span class="co"># see code below</span>
<span class="op">}</span></pre></div>
<p>Inside the function, we need to validate the input:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># Validate input</span>
<span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/assert_is_all_of.html">assert_is_any_of</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/assert_is_all_of.html">assert_is_any_of</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/assert_is_all_of.html">assert_is_any_of</a></span><span class="op">(</span><span class="va">size</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># select columns only containing numeric or integer values</span>
<span class="va">x</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">is.integer</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">is.integer</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>
<span class="va">size</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">is.integer</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>

<span class="co"># provide column names</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Y_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Size_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span>

<span class="co"># check correct dimensions</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The number of rows in 'x' and 'y' is not equal."</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The number of rows in 'x' and 'size' is not equal."</span><span class="op">)</span>

<span class="co"># check optional parameters</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">colour_by</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/assert_is_all_of.html">assert_is_any_of</a></span><span class="op">(</span><span class="va">colour_by</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">colour_by</span> <span class="op">%&lt;&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">is.integer</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">is.factor</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">colour_by</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">colour_by</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Color_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">colour_by</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">colour_by</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The number of rows in 'x' and 'colour_by' is not equal."</span><span class="op">)</span>
<span class="op">}</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span> <span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/assert_is_all_of.html">assert_is_any_of</a></span><span class="op">(</span><span class="va">labels</span>, <span class="st">"vector"</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span> <span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/is_character.html">is_character</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span> <span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/is_character.html">is_character</a></span><span class="op">(</span><span class="va">x_title</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span> <span class="fu">assertive.types</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertive.types/man/is_character.html">is_character</a></span><span class="op">(</span><span class="va">y_title</span><span class="op">)</span></pre></div>
<p>Then the input is saved into an .Rds file. The <code>title</code> of the component as well as the <code>env_id</code> are not saved and will be provided as characters by knitting the template.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Create random env id</span>
<span class="va">env_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"env_"</span>, <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_rand_strings.html">stri_rand_strings</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, pattern <span class="op">=</span> <span class="st">"[A-Za-z0-9]"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create component environment</span>
<span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">env</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span>
<span class="va">env</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span>
<span class="va">env</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">size</span>
<span class="va">env</span><span class="op">$</span><span class="va">colour_by</span> <span class="op">&lt;-</span> <span class="va">colour_by</span>
<span class="va">env</span><span class="op">$</span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="va">labels</span>
<span class="va">env</span><span class="op">$</span><span class="va">x_title</span> <span class="op">&lt;-</span> <span class="va">x_title</span>
<span class="va">env</span><span class="op">$</span><span class="va">y_title</span> <span class="op">&lt;-</span> <span class="va">y_title</span>

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">env</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">dashboard</span><span class="op">@</span><span class="va">datadir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">env_id</span>, <span class="st">".rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>At the end of the function we return the rendered R markdown string of the component.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># Expand component</span>
<span class="va">timestamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">expanded_component</span> <span class="op">&lt;-</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_expand.html">knit_expand</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"templates"</span>, <span class="st">"bubbleplot.Rmd"</span>, package <span class="op">=</span> <span class="st">"i2dash.scrnaseq"</span><span class="op">)</span>, title <span class="op">=</span> <span class="va">title</span>, env_id <span class="op">=</span> <span class="va">env_id</span>, date <span class="op">=</span> <span class="va">timestamp</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">expanded_component</span><span class="op">)</span></pre></div>
</div>
<div id="r-markdown-template" class="section level2">
<h2 class="hasAnchor">
<a href="#r-markdown-template" class="anchor"></a>R Markdown template</h2>
<p>In the next step, we create an R markdown template file of the bubbleplot component <code>inst/templates/bubbleplot.Rmd</code>. At the top of this document the <code>title</code> in curved brackets will be replaced by the provided title during knitting. Also the <code>env_id</code> will be replaced and the correct .rds file will be read in. <code>is_shiny</code> contains a logical whether the i2dashboard is interactive and should use shiny or not.</p>
<pre><code>
### {{ title }}

```{r}
{{ env_id }} </code></pre>
<div id="the-static-mode" class="section level3">
<h3 class="hasAnchor">
<a href="#the-static-mode" class="anchor"></a>The static mode</h3>
<p>The following R code chunk is also in the same file <code>inst/templates/bubbleplot.Rmd</code>. This code chunk will be executed, if shiny is not used. All variables we define in this code chunk that are not inside a function should be unique. This is made possible by using the env_id in the curved brackets. During the knitting process, <code>{{ env_id }}</code> will be replaced by the ‘real’ env_id and the variable names will be valid in the final R markdown string.</p>
<p>First we set the variables for <code>x_title</code> and <code>y_title</code>. If the user had not provided his own titles, the names of the first column of <code>x</code> and <code>y</code> are used as the titles. If <code>colour_by</code> was provided the first column will be used as the input vector. In case of <code>labels</code>, the row names of <code>x</code> will be used, if <code>labels</code> was not provided by the user.</p>
<p>Next, the plotly chart is created by the <code><a href="../reference/plotly_bubbleplot.html">i2dash.scrnaseq::plotly_bubbleplot()</a></code> function. In the static mode the first columns of the dataframes <code>x</code> and <code>y</code> are used as input vectors. Finally a dataframe is created, that will be then provided as download.</p>
<pre>
```{r, eval=!is_shiny}
# set variables 
# the first column is always used
if(!is.null({{ env_id }}$x_title)) x_title_{{ env_id }} 
</pre>
</div>
<div id="the-interactive-mode" class="section level3">
<h3 class="hasAnchor">
<a href="#the-interactive-mode" class="anchor"></a>The interactive mode</h3>
<p>By adding Shiny to a flexdashboard, we create a dashboard that enables the user to change underlying parameters and see the results immediately. In our case we provide the possibility to select the values that should be mapped to the x- and y-axis as well as the values, that should be used as size factor and colouring. (The user can select the names of the column that should be used through shiny input widgets.) In a flexdashboard the code for the UI as well as the server code can be used within the same code chunk.The webpage of flexdashboard provides a good description how to use Shiny with flexdashboard (see <a href="https://rmarkdown.rstudio.com/flexdashboard/shiny.html">here</a>).</p>
<p>First we create Shiny <code>selectInput()</code> widgets if the target dataframe has more than one column. Also a download button will be provided, so the user can download the data that is used for the created plot. We handle the inputs by creating a reactive expression for each dataframe. Inside the reactives it is checked, if the dataframe has more than one column. If this is the case, the input values from the <code>selectInput()</code> widgets should be used. Then a <code>downloadHandler()</code> creates a dataframe containing the currently selected x, y, size and colour values for the download. Plotly’s function <code>renderPlotly()</code> outputs and renders a plotly object (generatet by the function <code><a href="../reference/plotly_bubbleplot.html">i2dash.scrnaseq::plotly_bubbleplot()</a></code>) within Shiny. Finally, the UI elements are stored in a dropdown menu created with the package <a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a>.</p>
<pre>
```{r, eval=is_shiny}
#
# shiny input widgets
#
ui_list  1){
  ui_list  1){
  ui_list  1){
  ui_list  1)
  ui_list size: ',size_{{ env_id }}()), y_title = y_title, x_title = x_title)
  
  
})

#
# Layout of component
#
shiny::fillRow(flex = c(NA, 1),
      shinyWidgets::dropdownButton(div(style='max-height: 350px; overflow-x: auto;',do.call(shiny::inputPanel, ui_list)),
                       circle = TRUE, status = 'danger', icon = icon('gear'), width = '300px',
                       tooltip = shinyWidgets::tooltipOptions(title = 'Click, to change plot settings:'))
      ,
      plotly::plotlyOutput('plot_{{ env_id }}', height = '100%')
)
```</pre>
</div>
</div>
</div>
<div id="example-of-a-custom-page" class="section level1">
<h1 class="hasAnchor">
<a href="#example-of-a-custom-page" class="anchor"></a>Example of a custom page</h1>
<p>In the following, it is explained how to design a custom flexdashboard page and use it as a template within i2dash. The creation of a customized page allows the developer to use his own layout and enables the possibility for linking components together.</p>
<p>The linking of components is based on the relation of the data used in the components (e.g. the data is organized in one dataframe and the components visualize different aspects of this dataframe). The linking mechanic contains several clicking and selecting events to highlight datapoints or recalculate the chart along the selected datapoints.</p>
<p>In order to accomplish this task, it is necessery to create an R function for validating and saving the input similar to the example above. The data necessary for <strong>all</strong> components of the custom page should be validated by this function.</p>
<p>Furthermore it is necessary to create a second file containing the Rmd template. The Rmd document does not contain the typical YAML header with the render parameters. This header will be added to the final i2dashboard in the assembling process. The Rmd document rather contains the template code of several components. As described above each component can provide a static and interactive version.</p>
<p>R Plotly supports several possibilities for linking charts together. It is possible to link plotly charts at client-side, which makes it possible to use this interactivity without Shiny in the static mode. In this case it is possible to use plotly in combination with the package <a href="https://rstudio.github.io/crosstalk/">Crosstalk</a> or manipulate the plots via JavaScript. In the chapter @ref(plotlystatic) we demonstrate how to use the client-side linking based on a <code>SharedData</code> object from Crosstalk. Nevertheless, the capabilities of client-side linking are limited by data transformation. R Plotly also supports several click events with Shiny that we can use for server-side linking of components in the interactive mode. This is explained in the chapters @ref(plotlyinteractive) and enables more complex datatransformations between the components.</p>
<div id="linking-plotly-based-components" class="section level2">
<h2 class="hasAnchor">
<a href="#linking-plotly-based-components" class="anchor"></a>Linking plotly based components</h2>
<div id="plotlystatic" class="section level3">
<h3 class="hasAnchor">
<a href="#plotlystatic" class="anchor"></a>The static mode</h3>
<p><a href="https://plotly-r.com/client-side-linking.html">This resource</a> provides a very detailed explanation of the client-side linking with R plotly. The example Rmd code below describes a very simple template for a page containing a scatterplot and a barplot linked together. The R code chunk that loads the data and checks, if shiny should be used, is only present once. The <code>env_id</code> is identical in all components of the page. For demonstration purpose the <code>mtcars</code> dataset is used instead of loading the data from the rds file. The following page contains a two-columns layout. In the <code>scatterplot</code> code chunk we create a <code>SharedData</code> obejct with the function <code><a href="https://rdrr.io/pkg/plotly/man/highlight_key.html">plotly::highlight_key()</a></code>. The <code>plotly</code> object uses this <code>SharedData</code> object instead of a simple dataframe. <code><a href="https://rdrr.io/pkg/plotly/man/highlight.html">plotly::highlight('plotly_selected')</a></code> defines the selection mode. In this case, we want to enable the selection of datapoints. The <code>barplot</code> code chunk creates the barplot chart, which uses the same <code>SharedData</code> object. The use of the same graphical queries defined by the <code>SharedData</code> object, enables the linking between the two plots. In this examle we can select datapoints of the scatterplot, which results in the rerendering of the number of observations of the barplot. We can also select bars of the barplot and the datapoints that belong to the bars will be highlighted.</p>
<p>It is also possible to create custom event handlers with JavaScript as described <a href="https://plotly-r.com/js-event-handlers.html">here</a> and use it in combination with plotly’s JavaScript functions <a href="https://plot.ly/javascript/plotlyjs-function-reference/#plotlyrestyle">Plotly.restyle</a> and <a href="https://plot.ly/javascript/plotlyjs-function-reference/#plotlyrelayout">Plotly.relayout</a> to change another plotly chart.</p>
<p><a href="https://plot.ly/javascript/plotlyjs-function-reference/#plotlyrestyle" class="uri">https://plot.ly/javascript/plotlyjs-function-reference/#plotlyrestyle</a></p>
<pre>

Client-side linking with i2dash
====================================================

Column
----------------------------------------------------

### Custom scatterplot

```{r}
#{{ env_id }} %
  plotly::highlight('plotly_selected') 

```

Column
----------------------------------------------------

### Custom barplot

```{r barplot, eval=is_shiny}

plotly::plot_ly(sd_{{ env_id }}, x = ~cyl, color = ~cyl) %&gt;%
  plotly::layout(
    xaxis = list(title = 'Number of cylinder'),
    yaxis = list(title = 'Number of observations'),
    barmode = 'overlay',
    showlegend = FALSE
  ) %&gt;%
  plotly::highlight('plotly_selected')
```</pre>
<p><img src="images/developer_guide/plotly_linking_static.PNG"></p>
</div>
<div id="plotlyinteractive" class="section level3">
<h3 class="hasAnchor">
<a href="#plotlyinteractive" class="anchor"></a>The interactive mode</h3>
<p>The following example is straight forward and demonstrates, how we can expand the capabilities of the dashboard by using Shiny widgets. The linking is implemented through plotly’s <code>event_data()</code>, which outputs the data of the selected/clicked or brushed points and defines the type of plotly event. With the <code>source</code> argument we provide an unique identifier to the scatterplot so we can adress the right plot in the `<code>event_data()</code> function. By using the <code>key</code> parameter, we define an unique identifier for for each row. In the <code>barplot</code> chunk the keys of the <code>event_data</code> are used to subset the dataframe according to the selected points and rerender the barplot. The linking of the barplot with the scatterplot require more complex code, which is not shown here. <a href="https://plotly-r.com/linking-views-with-shiny.html">This resource</a> provides a very detailed explanation of the server-side linking with R plotly.</p>
<p>An alternative solution would be to create a <code>SharedData</code> object in a reactive expression according to the Shiny input widget and use the Crosstalk mechanic to accomplish the task, similar to the example above. In more complex Shiny apps we do not recomend to use Shiny input widgets and reactives along with Crosstalk because the interference can cause unexpected behaviours.</p>
<pre>
  
Server-side linking with i2dash
====================================================

Column
----------------------------------------------------

### Custom scatterplot

```{r}
#{{ env_id }} % dplyr::select_if(is.factor) %&gt;% colnames()

# shiny input widget for grouping
df_input %
    plotly::layout(
      xaxis = list(title = names(df[input$grouping_df])),
      yaxis = list(title = 'Number of observations'),
      barmode = 'overlay',
      showlegend = FALSE
    )
})

plotly::plotlyOutput('barplot_df', height = '100%')
```</pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Arsenij Ustjanzew, Jens Preussner, Mario Looso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
