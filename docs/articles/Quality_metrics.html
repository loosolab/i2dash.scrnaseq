<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use-case 1: Quality metrics • i2dash.scrnaseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use-case 1: Quality metrics">
<meta property="og:description" content="i2dash.scrnaseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">i2dash.scrnaseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Get started</li>
    <li>
      <a href="../articles/Quality_metrics.html">Use-case 1: Quality metrics</a>
    </li>
    <li>
      <a href="../articles/sc_data_explorer.html">Use-case 2: Single-cell Data explorer</a>
    </li>
    <li>
      <a href="../articles/vis_parameterselection.html">Use-case 3: Visualized parameter selection</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Further reading</li>
    <li>
      <a href="../articles/Documentation.html">Documentation</a>
    </li>
    <li>
      <a href="../articles/Developer_guide.html">Developer guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Quality_metrics_files/header-attrs-2.5/header-attrs.js"></script><script src="Quality_metrics_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="Quality_metrics_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Quality_metrics_files/anchor-sections-1.0/anchor-sections.js"></script><link href="Quality_metrics_files/font-awesome-5.1.0/css/all.css" rel="stylesheet">
<link href="Quality_metrics_files/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use-case 1: Quality metrics</h1>
                        <h4 class="author">Arsenij Ustjanzew</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:arsenij.ustjanzew@mpi-bn.mpg.de" class="email">arsenij.ustjanzew@mpi-bn.mpg.de</a>
      
                              <h4 class="author">Jens Preussner</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:jens.preussner@mpi-bn.mpg.de" class="email">jens.preussner@mpi-bn.mpg.de</a>
      
                  
            <h4 class="date">28 Oktober 2020</h4>
      
      
      <div class="hidden name"><code>Quality_metrics.Rmd</code></div>

    </div>

    
    
<p>Vignette last complied on 2020-10-28. i2dash is licenced under MIT + file LICENSE.</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The first step in the analysis of single-cell RNA sequencing (scRNA-seq) data is quality control (QC). This step is essential for the further processing of the data and often requires a visual check, in order to effectively eliminate outliers and gain insight into the data set.</p>
<p>The following example demonstrates how to build a <code>SingleCellExperiment</code> object from a count-matrix, where each entry represents the expression value of a given feature (rows) in the corresponding cell (column). We demonstrate, how to calculate quality metrics and create an interactive dashboard containing several quality metric plots and statistics. It illustrates the basic functions of the two packages <code>i2dash</code> and <code>i2dash.scrnaseq</code> and serves as a guide for beginners. You can inspect the demo of the resulting dashboard <a href="http://mpibn-mampok.134.176.27.161.xip.io/use-case-1/i2dash/">here</a>.</p>
</div>
<div id="setting-up-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#setting-up-the-data" class="anchor"></a>Setting up the data</h1>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_git.html">install_git</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://gitlab.gwdg.de/loosolab/software/i2dash.git"</span>, repos <span class="op">=</span> <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/repositories.html">repositories</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_git.html">install_git</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://gitlab.gwdg.de/loosolab/software/i2dash.scrnaseq.git"</span>, repos <span class="op">=</span> <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/repositories.html">repositories</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Install further necessary packages:</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SingleCellExperiment"</span>, <span class="st">"scater"</span>, <span class="st">"DropletUtils"</span>, <span class="st">"edgeR"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Matrix"</span>, <span class="st">"magrittr"</span>, <span class="st">"plotly"</span>, <span class="st">"kableExtra"</span>, <span class="st">"dplyr"</span>, <span class="st">"tidyr"</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Once installed, the packages can be loaded and attached to your current workspace as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">i2dash</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">i2dash.scrnaseq</span><span class="op">)</span></pre></div>
</div>
<div id="data-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h2>
<p>For this use-case the data from Rapolas Zilioni et al. “Single-Cell Transcriptomics of Human and Mouse Lung Cancers Reveals Conserved Myeloid Populations across Individuals and Species” was used <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. From the <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE127465">supplementary files</a> we downloaded <code>GSE127465_mouse_cell_metadata_15939x12.tsv.gz</code>, <code>GSE127465_gene_names_mouse_28205.tsv.gz</code> and <code>GSE127465_RAW.tar</code>. The normalized count-matrix was not used, instead we concatenated the raw counts from <code>GSE127465_RAW.tar</code> and filtered the features according to the <code>GSE127465_mouse_counts_normalized_15939x28205.mtx.gz</code> count-matrix. This step of concatination and filtering is NOT shown in the following, but for those who want to follow this optional part of the tutorial, we have provided the required count-matrix <a href="">here</a>. Further, we start the analysis with loading in the necessary files and building the <a href="https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html"><code>SingleCellExperiment</code></a> <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> (see the code below as an example for how to build a <code>SingleCellExperiment</code> object from a count-matrix).</p>
<p><strong>You can skip the following code chunk and simply use the final <code>SingleCellExperiment</code> provided by the package <a href="http://bioconductor.org/packages/devel/data/experiment/html/scRNAseq.html">scRNAseq</a>. See <a href="#load">code chunk</a></strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Load the data: a count matrix, the metadata and the gene names.</span>
<span class="co"># Note: define your current working directory, where the files are located with:</span>
<span class="co"># setwd("path/to/workdir")</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">magrittr</span><span class="op">)</span>
<span class="va">counts</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"raw_count_mtx.csv"</span>,
                       sep <span class="op">=</span> <span class="st">','</span>,
                       header <span class="op">=</span> <span class="cn">TRUE</span>,
                       row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"GSE127465_mouse_cell_metadata_15939x12.tsv"</span>,
                       sep <span class="op">=</span> <span class="st">'\t'</span>,
                       header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"GSE127465_gene_names_mouse_28205.tsv"</span>, 
                       sep <span class="op">=</span> <span class="st">"\t"</span>, 
                       header <span class="op">=</span> <span class="cn">FALSE</span>, 
                       col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"geneID"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Set the cell-labels and add row and column names to the counts</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">Barcode</span>, <span class="st">"_"</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">Library</span><span class="op">)</span>

<span class="co"># Assemble metadata into rowData and colData</span>
<span class="va">features</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"geneID"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">rowData</span>

<span class="va">colData</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">metadata</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">colData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cells</span>
<span class="va">redDim</span>            <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Create the SingleCellExperiment</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html">SingleCellExperiment</a></span><span class="op">(</span>
  assays      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"counts"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span>, 
  colData     <span class="op">=</span> <span class="va">colData</span>, 
  rowData     <span class="op">=</span> <span class="va">rowData</span>, 
  reducedDims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Spring_redDim"</span> <span class="op">=</span> <span class="va">redDim</span><span class="op">)</span>
<span class="op">)</span>


<span class="co"># Save the object for further analysis </span>
<span class="co"># (this SingleCellExperiment object will be used in the second use-case)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">sce</span>, <span class="st">"GSM3635304_mouse_sce.Rds"</span><span class="op">)</span>

<span class="va">sce</span></pre></div>
<p><a name="load"></a></p>
<p>This is the resulting <code>SingleCellExperiment</code> containing 28205 genes and 15939 cells:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span>

<span class="co"># Read the SingleCellExperiment</span>
<span class="va">sce_full</span> <span class="op">&lt;-</span> <span class="fu">scRNAseq</span><span class="fu">::</span><span class="fu">ZilionisLungData</span><span class="op">(</span><span class="st">"mouse"</span><span class="op">)</span>
<span class="va">sce_full</span> <span class="op">&lt;-</span> <span class="va">sce_full</span><span class="op">[</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">$</span><span class="va">Used</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">]</span>
<span class="va">as_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Library"</span>, <span class="st">"Animal"</span>, <span class="st">"Run"</span>, <span class="st">"Tissue"</span>, <span class="st">"Library prep batch"</span>, <span class="st">"Most likely Immgen cell type"</span>, <span class="st">"Major cell type"</span>, <span class="st">"Minor subset"</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">[</span><span class="va">as_factor</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span><span class="op">[</span><span class="va">as_factor</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span>

<span class="co"># optional downsampling for better performance</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce_full</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sce_full</span><span class="op">)</span>, <span class="fl">6000</span><span class="op">)</span><span class="op">]</span>
<span class="va">sce</span></pre></div>
</div>
</div>
<div id="calculating-quality-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-quality-metrics" class="anchor"></a>Calculating quality metrics</h1>
<p>Low-quality libraries in scRNA-seq data caused by e.g. cell damage or failure in library preparation manifest as cells with low total counts, few expressed genes and high mitochondrial proportions. To avoid misleading results in downstream analysis it is necessary to remove these cells during the quality control step of the analysis. <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>The quality metrics are computed for each cell with the <code><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics()</a></code> function from the <a href="https://bioconductor.org/packages/3.10/bioc/html/scater.html">scater</a> package. The following metrics are important for the further analysis <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>:</p>
<ul>
<li>The <code>sum</code> column contains the total count for each cell.</li>
<li>The <code>detected</code> column contains the number of detected genes.</li>
<li>The <code>subsets_Mito_percent</code> column contains the percentage of reads mapped to mitochondrial transcripts.</li>
</ul>
<p>To identify cells that are outliers for the various QC metrics, the function <code><a href="https://rdrr.io/pkg/scater/man/quickPerCellQC.html">quickPerCellQC()</a></code> from the <a href="https://bioconductor.org/packages/3.10/bioc/html/scater.html">scater</a> package is used. The calculation of the metrics is based on the median absolute deviation (MAD) from the median value of each metric across all cells. <code><a href="https://rdrr.io/pkg/scater/man/quickPerCellQC.html">quickPerCellQC()</a></code> computes a DataFrame with one row per cell. Each column specifies a reason for why a cell was considered to be low quality, with the final <code>discard</code> column indicating whether the cell should be discarded or not<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Cell-level QC</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
<span class="va">per.cell</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span>, subsets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Mito <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"mt-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">per.cell</span><span class="op">)</span>

<span class="co"># Detect outliers</span>
<span class="va">qc.stats</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/quickPerCellQC.html">quickPerCellQC</a></span><span class="op">(</span><span class="va">sce</span>, percent_subsets<span class="op">=</span><span class="st">"subsets_Mito_percent"</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">qc.stats</span><span class="op">)</span></pre></div>
</div>
<div id="creating-an-i2dashboard-object" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-an-i2dashboard-object" class="anchor"></a>Creating an i2dashboard object</h1>
<p>At first, we create a new <code>i2dashboard</code> object. We provide a title for the dashboard as well as the author. If you are not familiar with the creation of an <code>i2dashboard</code> object, you should read the the vignette <em>“Creating iterative and interactive dashboards with i2dash”</em> of the <code>i2dash</code> package first.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Creating a new i2dashboard class object</span>
<span class="va">dashboard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-class.html">i2dashboard</a></span><span class="op">(</span>
  title       <span class="op">=</span> <span class="st">"scRNA-Seq Quality Metrics"</span>,
  author      <span class="op">=</span> <span class="st">"i2dash Team"</span>,
  interactive <span class="op">=</span> <span class="cn">FALSE</span>,
  theme       <span class="op">=</span> <span class="st">"yeti"</span>,
  datadir     <span class="op">=</span> <span class="st">"datadir_use_case1"</span>
<span class="op">)</span></pre></div>
</div>
<div id="adding-the-first-page-to-the-dashboard" class="section level1">
<h1 class="hasAnchor">
<a href="#adding-the-first-page-to-the-dashboard" class="anchor"></a>Adding the first page to the dashboard</h1>
<p>Now, add the first page to the dashboard by using the <code><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-pages.html">add_page()</a></code> function. This page will contain a short description of the dataset, which is saved in a separate Markdown file <code>description.md</code>. With the <code><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component()</a></code> function, we add the content of the Markdown file in the form of a component to the first page of the dashboard. In the <code>i2dash</code> vignette mentioned above, you can learn more about these two functions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Creating an introduction page</span>
<span class="co"># Add a component to the introduction page containing the text from "description.md"</span>
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-pages.html">add_page</a></span><span class="op">(</span>
  page   <span class="op">=</span> <span class="st">"intro"</span>,
  title  <span class="op">=</span> <span class="st">"Introduction"</span>,
  layout <span class="op">=</span> <span class="st">"default"</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"i2dash.scrnaseq"</span>, <span class="st">"data/description.md"</span><span class="op">)</span>,
  page      <span class="op">=</span> <span class="st">"intro"</span>
<span class="op">)</span></pre></div>
</div>
<div id="quality-control-page" class="section level1">
<h1 class="hasAnchor">
<a href="#quality-control-page" class="anchor"></a>Quality control page</h1>
<p>The second page of the dashboard contains several quality metric plots and visualize the key aspects of the quality control step. The storyboard layout is best suited for a sequence of thematically related visualizations. Therefore, we will use it on this page.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">&lt;-</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-pages.html">add_page</a></span><span class="op">(</span>
  <span class="va">dashboard</span>,
  page   <span class="op">=</span> <span class="st">"qc"</span>,
  title  <span class="op">=</span> <span class="st">"Quality Control"</span>,
  layout <span class="op">=</span> <span class="st">"storyboard"</span>
<span class="op">)</span></pre></div>
<div id="check-droplet-quality" class="section level2">
<h2 class="hasAnchor">
<a href="#check-droplet-quality" class="anchor"></a>Check droplet quality</h2>
<p>The first step of quality controll is to ensure that our dataset only contains viable cells, e.g. droplets that contain proper mRNA libraries. Therefore, the first plot will be the popular “knee plot”, which shows the relationship between the log rank (ordered cells according to the number of distinct UMIs observed) vs. the log total counts (the number of distinct UMIs for each barcode) <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>.</p>
<p>First, we compute the barcode rank statistics and identify the knee and inflection points with the <code><a href="https://rdrr.io/pkg/DropletUtils/man/barcodeRanks.html">barcodeRanks()</a></code> function from the <a href="https://bioconductor.org/packages/release/bioc/html/DropletUtils.html">DropletUtils</a> package. Then, we write a short function to define the horizontal lines according to the identified points. Finally, we plot the data by using the <a href="https://plot.ly/r/">plotly</a> package.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># Plot of Rank / total UMI</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span>

<span class="co"># Calculate barcode ranks</span>
<span class="va">bcrank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/barcodeRanks.html">barcodeRanks</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Function for horizontal lines</span>
<span class="va">hline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">color</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"line"</span>, x0 <span class="op">=</span> <span class="fl">0</span>, x1 <span class="op">=</span> <span class="fl">1</span>, xref <span class="op">=</span> <span class="st">"paper"</span>, y0 <span class="op">=</span> <span class="va">y</span>, y1 <span class="op">=</span> <span class="va">y</span>, line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># plot the data</span>
<span class="va">droplet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">bcrank</span><span class="op">)</span>, x <span class="op">=</span> <span class="op">~</span><span class="va">rank</span>, y <span class="op">=</span> <span class="op">~</span><span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"log"</span>, title <span class="op">=</span> <span class="st">"Rank"</span><span class="op">)</span>,
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"log"</span>, title <span class="op">=</span> <span class="st">"Total UMI count"</span><span class="op">)</span>,
    shapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="fu">hline</span><span class="op">(</span><span class="fu">metadata</span><span class="op">(</span><span class="va">bcrank</span><span class="op">)</span><span class="op">$</span><span class="va">inflection</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,
      <span class="fu">hline</span><span class="op">(</span><span class="fu">metadata</span><span class="op">(</span><span class="va">bcrank</span><span class="op">)</span><span class="op">$</span><span class="va">knee</span>, <span class="st">"dodgerblue"</span><span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span></pre></div>
<p>The knee plot can now be added with <code><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component()</a></code> to the quality control page. The <code>storyboard</code> layout of this page enables us to compose a longer text, that serves as the title of the component.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">&lt;-</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  dashboard <span class="op">=</span> <span class="va">dashboard</span>,
  component <span class="op">=</span> <span class="va">droplet</span>,
  page      <span class="op">=</span> <span class="st">"qc"</span>,
  title     <span class="op">=</span> <span class="st">"Total UMI count for each barcode in the dataset, plotted against its rank in decreasing order of total counts (Blue line = inflection; Green line = knee)."</span>
<span class="op">)</span></pre></div>
<p>The resulting dashboard page looks like this:</p>
<div class="figure">
<img src="images/use_case_1/knee_plot.PNG" alt="Figure 1: The resulting page with the knee plot after assembly of the dashboard." width="960"><p class="caption">
Figure 1: The resulting page with the knee plot after assembly of the dashboard.
</p>
</div>
</div>
<div id="plot-cell-metadata-grouped-by-condition" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-cell-metadata-grouped-by-condition" class="anchor"></a>Plot cell metadata grouped by condition</h2>
<p>The next plot enables us to inspect the distributions of QC metrics. With <code>plotly</code> we create a plot containing two violin subplots. One subplot shows the total counts per cell, the second plot describes the number of detected genes per cell. In both plots the cells are grouped by the condition “Tumor/Healthy” on the x-axis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>, 
  x <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  y <span class="op">=</span> <span class="op">~</span><span class="va">sum</span>, 
  color <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  type <span class="op">=</span> <span class="st">"violin"</span>, 
  box <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  meanline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  legendgroup <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Condition: Tumor/Healthy"</span><span class="op">)</span>,
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Total counts"</span><span class="op">)</span>
  <span class="op">)</span>
    
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>, 
  x <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  y <span class="op">=</span> <span class="op">~</span><span class="va">detected</span>, 
  color <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  type <span class="op">=</span> <span class="st">"violin"</span>, 
  box <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  meanline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  legendgroup <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>,
  showlegend <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Condition: Tumor/Healthy"</span><span class="op">)</span>,
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Detected genes"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>, 
  x <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  y <span class="op">=</span> <span class="op">~</span><span class="va">subsets_Mito_percent</span>, 
  color <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>, 
  type <span class="op">=</span> <span class="st">"violin"</span>, 
  box <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  meanline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>visible <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, 
  legendgroup <span class="op">=</span> <span class="op">~</span><span class="va">Tissue</span>,
  showlegend <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Condition: Tumor/Healthy"</span><span class="op">)</span>,
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mitochondrial transcripts [%]"</span><span class="op">)</span>
  <span class="op">)</span>
    
<span class="va">plot_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/subplot.html">subplot</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, titleY <span class="op">=</span> <span class="cn">TRUE</span>, titleX <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p>The new created plot is added to the QC page, exactly as before. We provide a short descriptional sentence as the component title.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="va">plot_metadata</span>,
  page      <span class="op">=</span> <span class="st">"qc"</span>,
  title     <span class="op">=</span> <span class="st">"Key quality metrics for the cell grouped by tissue"</span>
<span class="op">)</span></pre></div>
<div class="figure">
<img src="images/use_case_1/metadata_violin.PNG" alt="Figure 2: The resulting page with the violin plots displaying QC metrics after assembly of the dashboard." width="960"><p class="caption">
Figure 2: The resulting page with the violin plots displaying QC metrics after assembly of the dashboard.
</p>
</div>
</div>
<div id="cell-filtering" class="section level2">
<h2 class="hasAnchor">
<a href="#cell-filtering" class="anchor"></a>Cell filtering</h2>
<p>The next tab of the QC page shows a scatterplot containing the number of expressed genes against the percentage of reads mapped to genes in the mitochondrial genome. Each point represents a cell. The plot is coloured by the detected outliers. Well-behaved cells show a large number of expressed genes and a low percentage of mitochondrial expression <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">cell_filtering</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>, 
  x <span class="op">=</span> <span class="op">~</span><span class="va">detected</span>, 
  y <span class="op">=</span> <span class="op">~</span><span class="va">subsets_Mito_percent</span>, 
  color <span class="op">=</span> <span class="op">~</span><span class="va">discard</span>,
  type <span class="op">=</span> <span class="st">"scatter"</span>,
  colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mitochondrial transcripts [%]"</span><span class="op">)</span>,
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Detected genes"</span>, type <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>
  <span class="op">)</span></pre></div>
<p>As before, we load the <code>plotly</code> object into a copmonent and append the component to the QC page.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="va">cell_filtering</span>,
  page      <span class="op">=</span> <span class="st">"qc"</span>,
  title     <span class="op">=</span> <span class="st">"Scatterplot of reads mapped to mitochondrial transcripts (%) against detected genes, coloured by discarded cells (red). Each point represents a cell."</span>
<span class="op">)</span></pre></div>
<div class="figure">
<img src="images/use_case_1/cell_filtering.PNG" alt="Figure 3: The resulting page with the scatterplot representing the cell filtering after assembly of the dashboard." width="960"><p class="caption">
Figure 3: The resulting page with the scatterplot representing the cell filtering after assembly of the dashboard.
</p>
</div>
</div>
<div id="feature-filtering" class="section level2">
<h2 class="hasAnchor">
<a href="#feature-filtering" class="anchor"></a>Feature filtering</h2>
<p>The last plot allows us to check if an entire cell type is inadvertently discarded by looking for systematic differences in gene expression between the discarded and retained cells. The following code was taken and changed from this source <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co"># check if the discarded pool is enriched for a certain cell type</span>
<span class="va">lost</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/calculateAverage.html">calculateAverage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[</span>,<span class="op">!</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">discard</span><span class="op">]</span><span class="op">)</span>
<span class="va">kept</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/calculateAverage.html">calculateAverage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[</span>,<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">discard</span><span class="op">]</span><span class="op">)</span>

<span class="co"># get mitochondrial transcripts</span>
<span class="va">is.mito</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^mt-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>

<span class="co"># compute the logFC and average count</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioinf.wehi.edu.au/edgeR">edgeR</a></span><span class="op">)</span>
<span class="va">logged</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html">cpm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lost</span>, <span class="va">kept</span><span class="op">)</span>, log<span class="op">=</span><span class="cn">TRUE</span>, prior.count<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">logFC</span>     <span class="op">&lt;-</span> <span class="va">logged</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">logged</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">logged</span><span class="op">)</span>

<span class="co"># creating a DataFrame containing the data and a column for colouring the genes</span>
<span class="va">df_discarded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">abundance</span>, logFC <span class="op">=</span> <span class="va">logFC</span><span class="op">)</span>
<span class="va">df_discarded</span><span class="op">$</span><span class="va">colour_by</span> <span class="op">&lt;-</span> <span class="st">"gene"</span>
<span class="va">df_discarded</span><span class="op">$</span><span class="va">colour_by</span><span class="op">[</span><span class="va">is.mito</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"mito.transcript"</span></pre></div>
<p>The scatterplot shows the log-fold change in expression in the discarded cells compared to the retained cells. Each point represents a gene. Mitochondrial transcripts are colour highlighted. This plot is also appended to the QC page of the dashboard.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># Plotting</span>
<span class="va">feature_filtering</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span>
  <span class="va">df_discarded</span>, 
  x <span class="op">=</span> <span class="op">~</span><span class="va">abundance</span>, 
  y <span class="op">=</span> <span class="op">~</span><span class="va">logFC</span>,
  color <span class="op">=</span> <span class="op">~</span><span class="va">colour_by</span>,
  type <span class="op">=</span> <span class="st">"scatter"</span>,
  colors <span class="op">=</span> <span class="st">"Set2"</span>,
  text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df_discarded</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/layout.html">layout</a></span><span class="op">(</span>
    xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average count"</span><span class="op">)</span>,
    yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"LogFC(lost/kept)"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Add the plot as component to the dashboard</span>
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="va">feature_filtering</span>,
  page      <span class="op">=</span> <span class="st">"qc"</span>,
  title     <span class="op">=</span> <span class="st">"Log-fold change in expression of the discarded cells compared to the retained cells. Each point represents a gene (mitochondrial transcripts in orange)."</span>
<span class="op">)</span></pre></div>
<div class="figure">
<img src="images/use_case_1/feature_filtering.PNG" alt="Figure 4: The resulting page with the scatterplot for checking cell type loss by looking for systematic differences in gene expression between the discarded and retained cell." width="590"><p class="caption">
Figure 4: The resulting page with the scatterplot for checking cell type loss by looking for systematic differences in gene expression between the discarded and retained cell.
</p>
</div>
</div>
</div>
<div id="summary-page" class="section level1">
<h1 class="hasAnchor">
<a href="#summary-page" class="anchor"></a>Summary page</h1>
<p>To give the user an overview of the filtered cells and other statistics, we create a new page called “Summary” with a 2x2 grid layout and append it to our dashboard.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-pages.html">add_page</a></span><span class="op">(</span>
  page   <span class="op">=</span> <span class="st">"summary"</span>,
  title  <span class="op">=</span> <span class="st">"Summary"</span>,
  layout <span class="op">=</span> <span class="st">"2x2_grid"</span>
<span class="op">)</span></pre></div>
<div id="summary-table" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-table" class="anchor"></a>1. summary table</h2>
<p>The 2x2 grid layout can hold four components at maximum, which are added columnwise. The first table shows the minimum, maximum, mean and median of the cell metadata. To generate this table the function <code><a href="../reference/summarize_metadata.html">summarize_metadata()</a></code> from the <code>i2dash.scrnaseq</code> package is used. We provide the <code>SingleCellExperiment</code> object as input for this function, specify the columns of metadata (colData of the sce) that should be summarized and optionally set a factorial column for grouping the results. Per default this function calculates the four statistics mentioned above, but the author can specify, which functions should be used with the parameter <code>FUNS</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">&lt;-</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  dashboard <span class="op">=</span> <span class="va">dashboard</span>,
  component <span class="op">=</span> <span class="fu">i2dash.scrnaseq</span><span class="fu">::</span><span class="va"><a href="../reference/summarize_metadata.html">summarize_metadata</a></span>,
  object    <span class="op">=</span> <span class="va">sce</span>,
  from      <span class="op">=</span> <span class="st">"colData"</span>,
  columns   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="st">"detected"</span>, <span class="st">"subsets_Mito_percent"</span><span class="op">)</span>,
  group_by  <span class="op">=</span> <span class="st">"Tissue"</span>,
  page      <span class="op">=</span> <span class="st">"summary"</span>,
  title     <span class="op">=</span> <span class="st">"Metadata statistic"</span>
<span class="op">)</span></pre></div>
<p>The output is acomponeten containing the following HTML table:</p>
<table class="table table table-striped table table-striped">
<thead>
<tr>
<th style="border-bottom:hidden" colspan="1">
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
min
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
max
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
mean
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
median
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
h
</th>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
h
</th>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
h
</th>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
h
</th>
<th style="text-align:right;">
t
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
sum
</td>
<td style="text-align:right;">
689
</td>
<td style="text-align:right;">
637
</td>
<td style="text-align:right;">
15811.000
</td>
<td style="text-align:right;">
26214.000
</td>
<td style="text-align:right;">
2364.794
</td>
<td style="text-align:right;">
2482.075
</td>
<td style="text-align:right;">
2046.000
</td>
<td style="text-align:right;">
1979.000
</td>
</tr>
<tr>
<td style="text-align:left;">
detected
</td>
<td style="text-align:right;">
238
</td>
<td style="text-align:right;">
116
</td>
<td style="text-align:right;">
3262.000
</td>
<td style="text-align:right;">
5360.000
</td>
<td style="text-align:right;">
895.875
</td>
<td style="text-align:right;">
940.917
</td>
<td style="text-align:right;">
833.000
</td>
<td style="text-align:right;">
829.000
</td>
</tr>
<tr>
<td style="text-align:left;">
subsets_Mito_percent
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14.941
</td>
<td style="text-align:right;">
14.983
</td>
<td style="text-align:right;">
2.180
</td>
<td style="text-align:right;">
3.452
</td>
<td style="text-align:right;">
0.348
</td>
<td style="text-align:right;">
2.376
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; border: 0;" colspan="100%">
<span style="font-weight: bold;text-decoration: underline;">Note: </span> <sup></sup> Summarized values from samples.
</td>
</tr></tfoot>
</table>
</div>
<div id="summary-table-1" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-table-1" class="anchor"></a>2. summary table</h2>
<p>The second table is a little bit more complicated to create and shows the number of kept and discarded cells, grouped by conditions. For each state of a categorical condition per row the numbers of kept/discarded cells are presented. The final HTML table is created with the package <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">kableExtra</a> and looks for the first two conditions as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>

<span class="co"># Select columns with factorial conditions</span>
<span class="va">factor_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tissue"</span>, <span class="st">"Animal"</span>, <span class="st">"Library"</span>, <span class="st">"Major.cell.type"</span><span class="op">)</span>

<span class="co"># Initialize DataFrame with the total number of kept/discarded cells </span>
<span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="st">"total"</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">discard</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">discard</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"condition"</span>, <span class="st">"FALSE"</span>, <span class="st">"TRUE"</span><span class="op">)</span> <span class="co"># column names are changed for further use</span>
<span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># a vector to save the rownumber (row per factorial level) of each condition.</span>

<span class="co"># Calculate the number of kept and discarded cells per condition and bind it to the DataFrame</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">column</span> <span class="kw">in</span> <span class="va">factor_columns</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">discard</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">syms</a></span><span class="op">(</span><span class="va">column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_samples <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">discard</span>, values_from <span class="op">=</span> <span class="va">n_samples</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"condition"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">stat</span>
  <span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">table</span>, <span class="va">stat</span><span class="op">)</span>
  <span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">stat</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Change column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"condition"</span>, <span class="st">"kept"</span>, <span class="st">"discarded"</span><span class="op">)</span>
<span class="va">end_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span> <span class="co"># get the rownumber indicating the end of a condition</span>

<span class="co"># Create html table with the package kableExtra</span>
<span class="va">summary2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">table</span>, caption <span class="op">=</span> <span class="st">"Number of kept / discarded cells per condition."</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span><span class="op">)</span><span class="op">)</span>
  
<span class="co"># Create groupings in the table by conditions</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">factor_columns</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">summary2</span> <span class="op">%&lt;&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html">pack_rows</a></span><span class="op">(</span><span class="va">factor_columns</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>, <span class="va">end_rows</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>, <span class="va">end_rows</span><span class="op">[</span><span class="va">index</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<table class="table table table-striped table-hover">
<caption>
Number of kept and discarded cells per condition.
</caption>
<thead><tr>
<th style="text-align:left;">
condition
</th>
<th style="text-align:right;">
kept
</th>
<th style="text-align:right;">
discarded
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
total
</td>
<td style="text-align:right;">
13746
</td>
<td style="text-align:right;">
2193
</td>
</tr>
<tr grouplength="2">
<td colspan="3" style="border-bottom: 1px solid;">
<strong>Tumor.or.healthy</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
healthy
</td>
<td style="text-align:right;">
5999
</td>
<td style="text-align:right;">
739
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
tumor
</td>
<td style="text-align:right;">
7747
</td>
<td style="text-align:right;">
1454
</td>
</tr>
<tr grouplength="4">
<td colspan="3" style="border-bottom: 1px solid;">
<strong>Biological.replicate</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Healthy 1
</td>
<td style="text-align:right;">
2661
</td>
<td style="text-align:right;">
289
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Healthy 2
</td>
<td style="text-align:right;">
3338
</td>
<td style="text-align:right;">
450
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Tumor-bearing 1
</td>
<td style="text-align:right;">
4929
</td>
<td style="text-align:right;">
812
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Tumor-bearing 2
</td>
<td style="text-align:right;">
2818
</td>
<td style="text-align:right;">
642
</td>
</tr>
</tbody>
</table>
</div>
<div id="summary-table-2" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-table-2" class="anchor"></a>3. summary table</h2>
<p>The last table summarizes also the number of kept and discarded cells. Each row is a reason for discarding created by the function <code><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics()</a></code> during the outlier detection step.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">CellFilterStat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low_n_features"</span>, <span class="st">"high_subsets_Mito_percent"</span>, <span class="st">"discard"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">summary</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">CellFilterStat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"reason"</span>, <span class="st">"kept"</span>, <span class="st">"discarded"</span><span class="op">)</span>
<span class="va">summary3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">CellFilterStat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Number of kept / discarded cells per reason for filtering"</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span><span class="op">)</span><span class="op">)</span></pre></div>
<table class="table table table-striped table-hover">
<caption>
Number of kept/discarded cells per reason for filtering
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
kept
</th>
<th style="text-align:left;">
discarded
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
low_n_features
</td>
<td style="text-align:left;">
15759
</td>
<td style="text-align:left;">
180
</td>
</tr>
<tr>
<td style="text-align:left;">
high_subsets_Mito_percent
</td>
<td style="text-align:left;">
13883
</td>
<td style="text-align:left;">
2056
</td>
</tr>
<tr>
<td style="text-align:left;">
discard
</td>
<td style="text-align:left;">
13746
</td>
<td style="text-align:left;">
2193
</td>
</tr>
</tbody>
</table>
<p>Finally, we append the last two tables to the Summary page.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">dashboard</span> <span class="op">%&lt;&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="va">summary2</span>,
  page      <span class="op">=</span> <span class="st">"summary"</span>,
  title     <span class="op">=</span> <span class="st">"Cell filtering 1"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/i2dashboard-content.html">add_component</a></span><span class="op">(</span>
  component <span class="op">=</span> <span class="va">summary3</span>,
  page      <span class="op">=</span> <span class="st">"summary"</span>,
  title     <span class="op">=</span> <span class="st">"Cell filtering 2"</span>
  <span class="op">)</span></pre></div>
<div class="figure">
<img src="images/use_case_1/summary.PNG" alt="Figure 5: The resulting summary page." width="589"><p class="caption">
Figure 5: The resulting summary page.
</p>
</div>
<p><a name="assemble"></a></p>
</div>
</div>
<div id="assembling-the-dashboard" class="section level1">
<h1 class="hasAnchor">
<a href="#assembling-the-dashboard" class="anchor"></a>Assembling the dashboard</h1>
<p>The final step is the assembly of the dashboard. During this step an R markdown (Rmd) document is created. This Rmd can be deployed to a Shiny Server to be shared. Alternatively, as the mode of this dashboard is not interactive, the dashboard can be rendered directly into a standalone HTML document with the parameter <code>render</code>. Note that an i2dashboard has a “default” page, which is empty and should be excluded from assembling if it was not used. Also it is worth mentioning, that the dashboard can be assembled and inspected after each step of content addition.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="fu">i2dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/i2dash/man/assemble.html">assemble</a></span><span class="op">(</span><span class="va">dashboard</span>, file <span class="op">=</span> <span class="st">"QCDashboard.Rmd"</span>, exclude <span class="op">=</span> <span class="st">"default"</span>, render <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><em>Single-Cell Transcriptomics of Human and Mouse Lung Cancers Reveals Conserved Myeloid Populations across Individuals and Species</em>, Immunity, published: April 09, 2019, Rapolas Zilionis et al. <a href="https://www.cell.com/immunity/fulltext/S1074-7613(19)30126-8#%20">link</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Further information on the SingleCellExperiment class <a href="https://osca.bioconductor.org/data-infrastructure.html#prerequisites">here</a> and <a href="https://bioconductor.org/packages/release/bioc/vignettes/SingleCellExperiment/inst/doc/intro.html">here</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Further information on quality control <a href="https://osca.bioconductor.org/quality-control.html#quality-control-motivation">here</a>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Further information on <code><a href="https://rdrr.io/pkg/scater/man/perCellQCMetrics.html">perCellQCMetrics()</a></code> <a href="https://rdrr.io/github/davismcc/scater/man/perCellQCMetrics.html">here</a>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Further information on <code><a href="https://rdrr.io/pkg/scater/man/quickPerCellQC.html">quickPerCellQC()</a></code> <a href="https://rdrr.io/github/davismcc/scater/man/quickPerCellQC.html">here</a>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Further information on the knee plot <a href="https://liorpachter.wordpress.com/tag/knee-plot/">here</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Further information on diagnostic plots <a href="https://osca.bioconductor.org/quality-control.html#quality-control-plots">here</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Further information on cell type loss <a href="https://osca.bioconductor.org/quality-control.html#removing-low-quality-cells">here</a><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Arsenij Ustjanzew, Jens Preussner, Mario Looso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
